<!DOCTYPE html>
<html>
<head>
  <title>Solar System</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/three@0.130.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.7/dat.gui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three/examples/js/loaders/GLTFLoader.js"></script>
  <script>

    function createPlanet(planetData) {
      const planet = new THREE.Object3D();

      const planetMaterial = new THREE.MeshPhongMaterial({ color: planetData.color });
      const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);
      planetMesh.scale.set(planetData.size, planetData.size, planetData.size);
      planet.add(planetMesh);

      // Load texture for each planet
      if (planetData.texture) {
        const textureLoader = new THREE.TextureLoader();
        const texture = textureLoader.load(planetData.texture);
        planetMaterial.map = texture;
      }

      // Add ring only to Saturn
      if (planetData.planet === 'Saturn') {
        const textureLoader = new THREE.TextureLoader();
        const ringTexture = textureLoader.load('./textures/8k_saturn_ring_alpha.png');
        const ringGeometry = new THREE.RingGeometry(planetData.size + 0.1, planetData.size + 0.2, 64);
        const ringMaterial = new THREE.MeshPhongMaterial({ color: planetData.ringColor, map: ringTexture, side: THREE.DoubleSide, transparent: true });
        const ringMesh = new THREE.Mesh(ringGeometry, ringMaterial);
        ringMesh.rotation.x = Math.PI / 2;
        planet.add(ringMesh);
      }

      // Create a circular path
      // const path = new THREE.Path();
      // path.absarc(0, 0, planetData.distance, 0, Math.PI * 2, false);
      // const tubeGeometry = new THREE.TubeGeometry(path, 64, 0.01, 32, false);
      // const tubeMaterial = new THREE.MeshPhongMaterial({ color: 0xffffff });
      // const pathMesh = new THREE.Mesh(tubeGeometry, tubeMaterial);
      // planet.add(pathMesh);


      planet.position.x = planetData.distance;
      scene.add(planet);
      return planet;
    }

    function updatePlanet(planet, planetData) {
      const planetMesh = planet.children[0];
      planetMesh.material.color.setHex(planetData.color);
      planetMesh.scale.set(planetData.size, planetData.size, planetData.size);
      planetParams[planetData.index] = planetData;
    }

    function animate() {
      requestAnimationFrame(animate);
      planets.forEach((planet, index) => {
        const planetData = planetParams[index];
        planet.rotation.y += planetData.speed;
        planet.position.x = planetData.distance * Math.cos(planet.rotation.y);
        planet.position.z = planetData.distance * Math.sin(planet.rotation.y);
      });
      
      sun.rotation.y += 0.0005;
      galaxy.rotation.y += 0.0005;
      controls.update();
      renderer.render(scene, camera);
    }

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(10, 10, 15);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const sunGeometry = new THREE.SphereGeometry(1, 32, 32);
    const sunTexture = new THREE.TextureLoader().load('./textures/8k_sun.jpg');
    const sunMaterial = new THREE.MeshBasicMaterial({ map: sunTexture });
    const sun = new THREE.Mesh(sunGeometry, sunMaterial);
    scene.add(sun);

    const galaxy = createGalaxy();

    function createGalaxy() {
      const galaxyGeometry = new THREE.SphereGeometry(100, 32, 32);

      const textureLoader = new THREE.TextureLoader();
      const texture = textureLoader.load('./textures/8k_stars_milky_way.jpg');
      const galaxyMaterial = new THREE.MeshBasicMaterial({ map: texture, side: THREE.BackSide });

      return new THREE.Mesh(galaxyGeometry, galaxyMaterial);
    }

    const planetGeometry = new THREE.SphereGeometry(1, 32, 32);
    const planetParams = [
      { planet: 'Mercury', color: 0xffffff, size: 0.2, speed: 0.01, distance: 2, index: 0, texture: './textures/mercury.jpg' },
      { planet: 'Venus', color: 0xffffff, size: 0.3, speed: 0.008, distance: 3, index: 1, texture: './textures/venus.jpg' },
      { planet: 'Earth', color: 0xffffff, size: 0.4, speed: 0.006, distance: 4, index: 2, texture: './textures/earth.jpg' },
      { planet: 'Mars', color: 0xffffff, size: 0.25, speed: 0.005, distance: 5, index: 3, texture: './textures/mars.jpg' },
      { planet: 'Jupiter', color: 0xffffff, size: 0.6, speed: 0.003, distance: 7, index: 4, texture: './textures/jupiter.jpg' },
      { planet: 'Saturn', color: 0xffffff, size: 0.5, speed: 0.002, distance: 9, index: 5, texture: './textures/saturn.jpg' },
      { planet: 'Uranus', color: 0xffffff, size: 0.35, speed: 0.001, distance: 11, index: 6, texture: './textures/uranus.jpg' },
      { planet: 'Neptune', color: 0xffffff, size: 0.3, speed: 0.0005, distance: 13, index: 7, texture: './textures/neptune.jpg' }
    ];

    const planets = planetParams.map(createPlanet);

    const gui = new dat.GUI();
    planetParams.forEach(planetData => {
      const folder = gui.addFolder(planetData.planet);
      folder.addColor(planetData, 'color').onChange(() => updatePlanet(planets[planetData.index], planetData));
      folder.add(planetData, 'size', 0, 10).onChange(() => updatePlanet(planets[planetData.index], planetData));
      folder.add(planetData, 'speed', 0, 10).onChange(() => updatePlanet(planets[planetData.index], planetData));
      folder.add(planetData, 'distance', 1, 20).onChange(() => updatePlanetDistance(planetData));
    });

    function updatePlanet(planet, planetData) {
      const planetMesh = planet.children[0];
      planetMesh.material.color.setHex(planetData.color);
      planetMesh.scale.set(planetData.size, planetData.size, planetData.size);
      planetParams[planetData.index] = planetData;
    }

    function updatePlanetDistance(planetData) {
      const planet = planets[planetData.index];
      planet.position.x = planetData.distance;
      planetParams[planetData.index].distance = planetData.distance;
    }

    const light = new THREE.PointLight(0xffffff, );
    scene.add(light);
    scene.add(galaxy);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;

    animate();
  </script>
</body>
</html>
